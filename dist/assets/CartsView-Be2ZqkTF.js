import{_ as v,c as h,b as e,w as P,F as g,d as x,e as A,t as m,a as d,g as C,r as f,o as b,f as E,v as y,n as _,h as T}from"./index-DwjhUn82.js";var p={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"david777",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const U={data(){return{carts:[],totalPrice:{},form:{user:{email:"",name:"",tel:"",address:""},message:""}}},methods:{getCarts(){const{VITE_APP_URL:a,VITE_APP_PATH:t}=p,r=`${a}/api/${t}/cart`;this.$http.get(r).then(o=>{this.carts=o.data.data.carts,this.totalPrice={final_total:o.data.data.final_total,total:o.data.data.total}})},delAllCart(){const{VITE_APP_URL:a,VITE_APP_PATH:t}=p,r=`${a}/api/${t}/carts`;this.$http.delete(r).then(o=>{alert("購物車已清空"),console.log(o),this.getCarts()}).catch(o=>{alert("購物車無資料")})},updateCartNum(a,t=1){const{VITE_APP_URL:r,VITE_APP_PATH:o}=p,s=`${r}/api/${o}/cart/${a.id}`;console.log(a,t);const i={product_id:a.product_id,qty:t};this.$http.put(s,{data:i}).then(c=>{console.log(c),this.getCarts()})},isPhone(a){return/^(09)[0-9]{8}$/.test(a)?!0:"需要正確的電話號碼"},sendOrder(){const{VITE_APP_URL:a,VITE_APP_PATH:t}=p,r=`${a}/api/${t}/order`;this.$http.post(r,{data:this.form}).then(o=>{o.data.success&&(console.log(o),alert("訂單已送出"),this.getCarts(),this.$refs.form.resetForm())}).catch(o=>{alert("購物車無資料")})}},mounted(){this.getCarts()}},I={id:"app"},k={class:"container"},N={class:"mt-4"},w={class:"text-end"},R={class:"table align-middle"},F=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",{class:"text-end"},"單價")])],-1),L=e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm"},[e("i",{class:"fas fa-spinner fa-pulse"}),T(" x ")])],-1),S={class:"input-group input-group-sm"},q={class:"input-group mb-3"},D=["onUpdate:modelValue","onChange"],H={class:"input-group-text",id:"basic-addon2"},M={class:"text-end"},B=e("td",{colspan:"3",class:"text-end"},"總計",-1),O={class:"text-end"},j=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),z={class:"text-end text-success"},$={class:"my-5 row justify-content-center"},G={class:"mb-3"},J=e("label",{for:"email",class:"form-label"},"Email",-1),K={class:"mb-3"},Q=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),W={class:"mb-3"},X=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Y={class:"mb-3"},Z=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ee={class:"mb-3"},te=e("label",{for:"message",class:"form-label"},"留言",-1),se=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function le(a,t,r,o,s,i){const c=f("VField"),u=f("ErrorMessage"),V=f("VForm");return b(),h("div",I,[e("div",k,[e("div",N,[e("div",w,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:t[0]||(t[0]=P((...l)=>i.delAllCart&&i.delAllCart(...l),["prevent"]))}," 清空購物車 ")]),e("table",R,[F,e("tbody",null,[s.carts?(b(!0),h(g,{key:0},x(s.carts,l=>(b(),h("tr",{key:l.id},[L,e("td",null,m(l.product.title),1),e("td",null,[e("div",S,[e("div",q,[E(e("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":n=>l.qty=n,onChange:n=>i.updateCartNum(l,l.qty)},null,40,D),[[y,l.qty,void 0,{number:!0}]]),e("span",H,m(l.product.unit),1)])])]),e("td",M,[e("span",null,"單價 : "+m(l.product.price),1)])]))),128)):A("",!0)]),e("tfoot",null,[e("tr",null,[B,e("td",O,m(s.totalPrice.total),1)]),e("tr",null,[j,e("td",z,m(s.totalPrice.final_total),1)])])])]),e("div",$,[d(V,{ref:"form",class:"col-md-6",onSubmit:i.sendOrder},{default:C(({errors:l})=>[e("div",G,[J,d(c,{id:"email",name:"email",type:"email",class:_(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",rules:"required|email",modelValue:s.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=n=>s.form.user.email=n)},null,8,["class","modelValue"]),d(u,{name:"email",class:"invalid-feedback"})]),e("div",K,[Q,d(c,{id:"name",name:"name",type:"text",class:_(["form-control",{"is-invalid":l.name}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=n=>s.form.user.name=n)},null,8,["class","modelValue"]),d(u,{name:"name",class:"invalid-feedback"})]),e("div",W,[X,d(c,{id:"tel",name:"tel",type:"text",class:_(["form-control",{"is-invalid":l.tel}]),placeholder:"請輸入電話",rules:i.isPhone,modelValue:s.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=n=>s.form.user.tel=n)},null,8,["rules","class","modelValue"]),d(u,{name:"tel",class:"invalid-feedback"})]),e("div",Y,[Z,d(c,{id:"address",name:"address",type:"text",class:_(["form-control",{"is-invalid":l.address}]),placeholder:"請輸入地址",rules:"required",modelValue:s.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=n=>s.form.user.address=n)},null,8,["class","modelValue"]),d(u,{name:"address",class:"invalid-feedback"})]),e("div",ee,[te,d(c,{id:"message",class:"form-control",name:"message",cols:"30",rows:"10",as:"textarea",modelValue:s.form.message,"onUpdate:modelValue":t[5]||(t[5]=n=>s.form.message=n)},null,8,["modelValue"])]),se]),_:1},8,["onSubmit"])])])])}const ae=v(U,[["render",le]]);export{ae as default};
